{% extends 'institute/base.html' %}
{% load static %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <div
        class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl overflow-hidden border border-slate-100 dark:border-slate-700">
        <!-- Header -->
        <div class="bg-slate-50 dark:bg-slate-900/50 p-6 md:p-8 border-b border-slate-100 dark:border-slate-700">
            <h2 class="text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-3">
                <i class="fas fa-building text-indigo-600 dark:text-indigo-400"></i>
                Register Organization
            </h2>
            <p class="text-slate-500 dark:text-slate-400 mt-2">Register a new organization with TMIS portal</p>
        </div>

        <form method="POST" action="{% url 'register_organization' %}" enctype="multipart/form-data"
            class="p-6 md:p-8 space-y-8">
            {% csrf_token %}

            <!-- Organization Details -->
            <section>
                <h5 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-info-circle"></i> Organization Information
                </h5>

                <div class="space-y-4">
                    <div>
                        <label for="org_name"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Name of Organization <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="org_name" name="org_name" required
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                            placeholder="Enter full organization name">
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Enter the complete legal name of your
                            organization</p>
                    </div>

                    <div>
                        <label for="address"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Address <span class="text-red-500">*</span>
                        </label>
                        <textarea id="address" name="address" rows="3" required
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                            placeholder="Enter complete address"></textarea>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Include street, city, state, and
                            postal code</p>
                    </div>
                </div>
            </section>

            <!-- Logo Upload Section -->
            <section>
                <h5 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-image"></i> Organization Logo
                </h5>

                <div
                    class="bg-slate-50 dark:bg-slate-900/50 rounded-xl p-6 border-2 border-dashed border-slate-300 dark:border-slate-600 hover:border-indigo-500 dark:hover:border-indigo-500 transition-colors logo-upload-container">
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <!-- Preview Box -->
                        <div class="w-full md:w-40 md:h-40 min-w-[10rem] aspect-square rounded-lg border-2 border-dashed border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 flex items-center justify-center overflow-hidden relative group transition-colors"
                            id="logoPreviewWrapper">
                            <div id="logoPreview" class="text-center p-4">
                                <i class="fas fa-building text-4xl text-slate-300 dark:text-slate-600 mb-2"></i>
                                <p class="text-xs text-slate-400">Preview</p>
                            </div>
                        </div>

                        <!-- Upload Controls -->
                        <div class="flex-1 w-full">
                            <h6 class="font-semibold text-slate-900 dark:text-white mb-2">Upload Organization Logo</h6>
                            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">
                                Upload a high-quality logo. This will be displayed on certificates and documents.
                            </p>

                            <div class="block w-full">
                                <input type="file" id="org_logo" name="org_logo" accept=".jpg,.jpeg,.png,.gif,.svg"
                                    onchange="previewLogo(event)" class="block w-full text-sm text-slate-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-full file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100
                                    dark:file:bg-indigo-900/30 dark:file:text-indigo-300
                                    cursor-pointer">
                            </div>

                            <div
                                class="mt-4 text-xs text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-100 dark:border-slate-700">
                                <strong class="block mb-1">Requirements:</strong>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Max size: 5MB</li>
                                    <li>Formats: JPG, PNG, GIF, SVG</li>
                                    <li>Recommended: 300x300px (Transparent PNG)</li>
                                </ul>
                            </div>

                            <!-- File Info -->
                            <div id="fileInfo"
                                class="hidden mt-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-3 flex items-center justify-between">
                                <div class="flex items-center gap-3 overflow-hidden">
                                    <i class="fas fa-file-image text-indigo-500"></i>
                                    <div class="min-w-0">
                                        <p id="fileName"
                                            class="text-sm font-medium text-slate-700 dark:text-slate-200 truncate">
                                            filename.png</p>
                                        <p id="fileSize" class="text-xs text-slate-500 dark:text-slate-400">0 KB</p>
                                    </div>
                                </div>
                                <button type="button" onclick="removeLogo()"
                                    class="text-slate-400 hover:text-red-500 transition-colors p-2">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contact Info -->
            <section>
                <h5 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-address-book"></i> Contact Information
                </h5>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="mobile" class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Mobile Number <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" id="mobile" name="mobile" pattern="[0-9]{10}" required
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                            placeholder="Enter 10-digit mobile number">
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Format: 9876543210</p>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="email" name="email" required
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                            placeholder="Enter email address">
                    </div>
                </div>
            </section>

            <!-- Registration Details -->
            <section>
                <h5 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-id-card"></i> Registration Details
                </h5>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="regd_no"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Registration Number <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="regd_no" name="regd_no" required
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors font-mono"
                            placeholder="TMIS/XXX">
                        <div
                            class="mt-2 bg-slate-50 dark:bg-slate-900/50 p-2 rounded text-xs border-l-4 border-indigo-500 text-slate-600 dark:text-slate-400 font-mono">
                            Format: TMIS/01, TMIS/102
                        </div>
                    </div>

                    <div>
                        <label for="registration_date"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Registration Date
                        </label>
                        <input type="date" id="registration_date" name="registration_date"
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors">
                    </div>
                </div>
            </section>

            <!-- Additional Info -->
            <section>
                <h5 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-file-alt"></i> Additional Information
                </h5>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="org_type"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Organization Type
                        </label>
                        <select id="org_type" name="org_type"
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white transition-colors">
                            <option value="">Select type</option>
                            <option value="educational">Educational Institution</option>
                            <option value="coaching">Coaching Center</option>
                            <option value="trust">Trust/Foundation</option>
                            <option value="corporate">Corporate</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label for="contact_person"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                            Contact Person
                        </label>
                        <input type="text" id="contact_person" name="contact_person"
                            class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                            placeholder="Name of contact person">
                    </div>
                </div>

                <div>
                    <label for="remarks" class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1">
                        Remarks
                    </label>
                    <textarea id="remarks" name="remarks" rows="2"
                        class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 transition-colors"
                        placeholder="Any additional remarks"></textarea>
                </div>
            </section>

            <!-- Actions -->
            <div
                class="flex flex-col-reverse md:flex-row justify-between gap-4 pt-6 border-t border-slate-100 dark:border-slate-700">
                <a href="{% url 'admin_dashboard' %}"
                    class="px-6 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-medium rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-center">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
                </a>
                <button type="submit"
                    class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:-translate-y-0.5 transition-all duration-200">
                    <i class="fas fa-save mr-2"></i> Submit Registration
                </button>
            </div>
        </form>
    </div>

    <!-- Info Section -->
    <div
        class="mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-6 flex gap-4">
        <i class="fas fa-info-circle text-2xl text-blue-600 dark:text-blue-400 mt-1 shrink-0"></i>
        <div>
            <h6 class="font-bold text-blue-900 dark:text-blue-100 mb-2">Registration Guidelines</h6>
            <ul class="list-disc list-inside space-y-1 text-sm text-blue-800 dark:text-blue-200">
                <li>All fields marked with <span class="text-red-500">*</span> are mandatory</li>
                <li>Registration number must follow the format: <code
                        class="bg-blue-100 dark:bg-blue-900 px-1 py-0.5 rounded">TMIS/XXX</code></li>
                <li>Logo should be professional and clear</li>
                <li>Approval takes 2-3 working days</li>
            </ul>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    // Logo preview function
    function previewLogo(event) {
        const input = event.target;
        const preview = document.getElementById('logoPreview');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const wrapper = document.getElementById('logoPreviewWrapper');

        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size exceeds 5MB limit.');
                input.value = '';
                return;
            }

            // Preview
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-contain">`;
                wrapper.classList.remove('border-dashed');
                wrapper.classList.add('border-solid', 'border-indigo-500');
            }
            reader.readAsDataURL(file);

            // Info
            fileName.textContent = file.name;
            fileSize.textContent = (file.size / 1024).toFixed(2) + ' KB';
            fileInfo.classList.remove('hidden');
        }
    }

    function removeLogo() {
        document.getElementById('org_logo').value = '';
        document.getElementById('logoPreview').innerHTML = `
            <i class="fas fa-building text-4xl text-slate-300 dark:text-slate-600 mb-2"></i>
            <p class="text-xs text-slate-400">Preview</p>
        `;
        document.getElementById('fileInfo').classList.add('hidden');
        const wrapper = document.getElementById('logoPreviewWrapper');
        wrapper.classList.add('border-dashed');
        wrapper.classList.remove('border-solid', 'border-indigo-500');
    }

    // Auto-format regd no
    document.getElementById('regd_no').addEventListener('input', function (e) {
        let val = e.target.value.toUpperCase();
        e.target.value = val.replace(/[^A-Z0-9\/]/g, '');
    });
</script>
{% endblock %}

{% endblock %}