{% extends 'institute/base.html' %}
{% load static %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-3">
            <i class="fas fa-search-plus text-indigo-600 dark:text-indigo-400"></i>
            Search & Manage Admissions
        </h1>
    </div>

    {% if messages %}
    <div class="space-y-2">
        {% for message in messages %}
        <div
            class="p-4 rounded-xl {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %} flex justify-between items-center">
            <span class="text-sm font-medium">{{ message }}</span>
            <button onclick="this.parentElement.remove()" class="text-current opacity-50 hover:opacity-100"><i
                    class="fas fa-times"></i></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Search Section -->
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 p-6">
        <h5 class="text-lg font-bold text-slate-800 dark:text-white mb-4">Search Admission</h5>

        <!-- Tabs -->
        <div class="max-w-md mx-auto mb-6">
            <div class="flex p-1 bg-slate-100 dark:bg-slate-700 rounded-xl" id="searchTabs">
                <button onclick="switchTab('mobile')"
                    class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors bg-white dark:bg-slate-600 text-indigo-600 dark:text-white shadow-sm"
                    id="tab-mobile">
                    Mobile
                </button>
                <button onclick="switchTab('id')"
                    class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors text-slate-600 dark:text-slate-300 hover:text-indigo-600"
                    id="tab-id">
                    Admission ID
                </button>
                <button onclick="switchTab('general')"
                    class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors text-slate-600 dark:text-slate-300 hover:text-indigo-600"
                    id="tab-general">
                    General
                </button>
            </div>
        </div>

        <form method="GET" action="{% url 'search_admission' %}" class="max-w-2xl mx-auto space-y-4">

            <!-- Tab Contents -->
            <div id="content-mobile">
                <div class="relative">
                    <input type="text" name="search" placeholder="Enter 10-digit mobile number"
                        class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                        value="{% if search_type == 'mobile' %}{{ search_query }}{% endif %}">
                    <i class="fas fa-mobile-alt absolute left-4 top-3.5 text-slate-400"></i>
                </div>
            </div>

            <div id="content-id" class="hidden">
                <div class="relative">
                    <input type="text" name="search" placeholder="Enter Admission ID (e.g. TMIS0001)"
                        class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                        value="{% if search_type == 'admission_id' %}{{ search_query }}{% endif %}">
                    <i class="fas fa-id-card absolute left-4 top-3.5 text-slate-400"></i>
                </div>
            </div>
            <div id="content-general" class="hidden">
                <div class="relative">
                    <input type="text" name="search" placeholder="Name, Father's Name, Aadhaar..."
                        class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                        value="{% if search_type == 'general' %}{{ search_query }}{% endif %}">
                    <i class="fas fa-search absolute left-4 top-3.5 text-slate-400"></i>
                </div>
            </div>

            <button type="submit"
                class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 transition-all">
                Search Records
            </button>
        </form>
    </div>

    <!-- Main Form Section -->
    <div
        class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 md:p-8">
        <div class="flex items-center justify-between mb-8 pb-4 border-b border-slate-100 dark:border-slate-700">
            <h5 class="text-xl font-bold text-slate-800 dark:text-white">
                {% if admission %}
                <span class="text-amber-500"><i class="fas fa-edit mr-2"></i> Editing Admission</span>
                {% else %}
                <span class="text-emerald-600"><i class="fas fa-plus-circle mr-2"></i> New Admission</span>
                {% endif %}
            </h5>
            {% if admission %}
            <span class="px-3 py-1 bg-amber-100 text-amber-800 text-xs font-bold rounded-full">Editing ID: {{
                admission.admission_id }}</span>
            {% endif %}
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            {% if admission %}<input type="hidden" name="admission_id" value="{{ admission.id }}">{% endif %}

            <!-- Form Grid Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Image Section -->
                <div class="lg:col-span-1">
                    <div
                        class="bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-200 dark:border-slate-700 text-center">
                        <label class="block font-bold text-slate-700 dark:text-slate-300 mb-4">Student Photo</label>
                        <div
                            class="aspect-[3/4] bg-white dark:bg-slate-800 rounded-lg border-2 border-dashed border-slate-300 dark:border-slate-600 flex items-center justify-center overflow-hidden mb-4 relative group">
                            {% if admission and admission.student_image %}
                            <img src="{{ admission.student_image.url }}" class="w-full h-full object-cover">
                            {% else %}
                            <i class="fas fa-user text-4xl text-slate-300"></i>
                            {% endif %}
                        </div>
                        <input type="file" name="student_image"
                            class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>
                </div>

                <!-- Personal Details -->
                <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Student
                            Name</label>
                        <input type="text" name="student_name" value="{{ admission.student_name|default:'' }}"
                            class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Father's
                            Name</label>
                        <input type="text" name="father_name" value="{{ admission.father_name|default:'' }}"
                            class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Mobile</label>
                        <input type="text" name="mobile_number" value="{{ admission.mobile_number|default:'' }}"
                            class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Date of
                            Birth</label>
                        <input type="date" name="date_of_birth" value="{{ admission.date_of_birth|date:'Y-m-d' }}"
                            class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Address</label>
                        <input type="text" name="address" value="{{ admission.address|default:'' }}"
                            class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                    </div>
                </div>
            </div>

            <!-- More Details Collapsible or Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-6 border-t border-slate-100 dark:border-slate-700">
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Course</label>
                    <select name="course"
                        class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                        <option value="11th Science">11th Science</option>
                        <option value="12th Science">12th Science</option>
                        <!-- Add other options as needed -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Hostel Fees</label>
                    <input type="number" name="hostel_fees" value="{{ admission.hostel_fees|default:0 }}"
                        class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">TMS Fees</label>
                    <input type="number" name="tms_fees" value="{{ admission.tms_fees|default:0 }}"
                        class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
                </div>
            </div>

            <!-- Actions -->
            <div
                class="flex flex-col-reverse md:flex-row justify-between gap-4 pt-6 mt-6 border-t border-slate-100 dark:border-slate-700">
                <a href="{% url 'search_admission' %}"
                    class="px-6 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-medium rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 text-center">
                    Reset Form
                </a>

                {% if admission %}
                <button type="submit" name="action" value="update"
                    class="px-8 py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-xl shadow-lg shadow-amber-500/30">
                    <i class="fas fa-save mr-2"></i> Update Record
                </button>
                {% else %}
                <button type="submit" name="action" value="create"
                    class="px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-lg shadow-emerald-500/30">
                    <i class="fas fa-check mr-2"></i> Create Record
                </button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
    function switchTab(tabId) {
        // Reset Tabs
        document.querySelectorAll('#searchTabs button').forEach(btn => {
            btn.classList.remove('bg-white', 'dark:bg-slate-600', 'text-indigo-600', 'dark:text-white', 'shadow-sm');
            btn.classList.add('text-slate-600', 'dark:text-slate-300');
        });

        // Active Tab
        const activeBtn = document.getElementById('tab-' + tabId);
        activeBtn.classList.add('bg-white', 'dark:bg-slate-600', 'text-indigo-600', 'dark:text-white', 'shadow-sm');
        activeBtn.classList.remove('text-slate-600', 'dark:text-slate-300');

        // Toggle Content
        document.getElementById('content-mobile').classList.add('hidden');
        document.getElementById('content-id').classList.add('hidden');
        document.getElementById('content-general').classList.add('hidden');
        document.getElementById('content-' + tabId).classList.remove('hidden');
    }
</script>
{% endblock %}